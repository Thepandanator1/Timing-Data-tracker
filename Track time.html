<!DOCTYPE html>
<html>
<head>
  <title>Product Time Tracker</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input { width: 100px; margin-right: 5px; }
    table { border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #aaa; padding: 5px 10px; text-align: center; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <h1>Product Time Tracker</h1>

  <label for="steps">Number of Steps:</label>
  <input type="number" id="steps" value="4" min="1">
  <button id="generateBtn">Generate Table</button>

  <div id="tableContainer"></div>
  <button id="calculateBtn">Calculate Times</button>
  <button id="exportBtn">Export CSV</button>

  <h2>Results</h2>
  <div id="results"></div>

  <script>
    // Generate table
    function generateTable() {
      const container = document.getElementById('tableContainer');
      container.innerHTML = '';
      const steps = parseInt(document.getElementById('steps').value);
      if (!steps || steps < 1) { alert('Enter valid steps'); return; }

      const table = document.createElement('table');
      const header = document.createElement('tr');
      header.innerHTML = '<th>Step</th><th>Start</th><th>End</th>';
      table.appendChild(header);

      for (let i=1;i<=steps;i++){
        const row = document.createElement('tr');
        row.innerHTML = `<td>Step ${i}</td>
                         <td><input id="start${i}" placeholder="e.g. 8 or 8:30"></td>
                         <td><input id="end${i}" placeholder="e.g. 4 or 16:00"></td>`;
        table.appendChild(row);
      }
      container.appendChild(table);
    }

    // Parse time with automatic PM logic
    function parseTime(str) {
      str = str.trim();
      if (!str) return 0;
      const parts = str.split(':');
      let hours = parseInt(parts[0]);
      let minutes = parts[1] ? parseInt(parts[1]) : 0;
      if (isNaN(hours)) throw 'Invalid hour';
      if ((hours >= 6 && hours <= 12) || hours === 1) hours += 12;
      if (hours === 24) hours = 12;
      return hours*60 + minutes;
    }

    // Calculate durations and total
    function calculateTimes() {
      const steps = parseInt(document.getElementById('steps').value);
      let total=0;
      let html='<table><tr><th>Step</th><th>Duration (min)</th></tr>';
      for (let i=1;i<=steps;i++){
        const start = parseTime(document.getElementById(`start${i}`).value || '0');
        let end = parseTime(document.getElementById(`end${i}`).value || '0');
        if (end < start) end += 24*60; // overnight
        const duration = end - start;
        total += duration;
        html += `<tr><td>Step ${i}</td><td>${duration}</td></tr>`;
      }
      html += `<tr><td><b>Total</b></td><td><b>${total}</b></td></tr></table>`;
      document.getElementById('results').innerHTML = html;
    }

    // Export CSV
    function exportCSV() {
      const steps = parseInt(document.getElementById('steps').value);
      let csv='Step,Start,End,Duration\n';
      let total=0;
      for(let i=1;i<=steps;i++){
        const start = parseTime(document.getElementById(`start${i}`).value||'0');
        let end = parseTime(document.getElementById(`end${i}`).value||'0');
        if(end < start) end+=24*60;
        const duration = end - start;
        total+=duration;
        csv += `Step ${i},${document.getElementById(`start${i}`).value||'0'},${document.getElementById(`end${i}`).value||'0'},${duration}\n`;
      }
      csv += `Total,, ,${total}\n`;
      const blob = new Blob([csv], {type:'text/csv'});
      const link=document.createElement('a');
      link.href=URL.createObjectURL(blob);
      link.download='time_tracking.csv';
      link.click();
    }

    // Event listeners
    document.getElementById('generateBtn').addEventListener('click', generateTable);
    document.getElementById('calculateBtn').addEventListener('click', calculateTimes);
    document.getElementById('exportBtn').addEventListener('click', exportCSV);
  </script>
</body>
</html>
